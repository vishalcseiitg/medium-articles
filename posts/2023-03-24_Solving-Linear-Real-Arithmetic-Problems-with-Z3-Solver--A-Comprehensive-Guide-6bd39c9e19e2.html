<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Solving Linear Real Arithmetic Problems with Z3 Solver: A Comprehensive Guide</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Solving Linear Real Arithmetic Problems with Z3 Solver: A Comprehensive Guide</h1>
</header>
<section data-field="subtitle" class="p-summary">
“Automated reasoning and formal verification have become essential tools in modern computer science and mathematics, enabling the efficient…
</section>
<section data-field="body" class="e-content">
<section name="06dd" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="24ca" id="24ca" class="graf graf--h3 graf--leading graf--title">Solving Linear Real Arithmetic Problems with Z3 Solver: A Comprehensive Guide</h3><blockquote name="9556" id="9556" class="graf graf--pullquote graf--startsWithDoubleQuote graf-after--h3">“Automated reasoning and formal verification have become essential tools in modern computer science and mathematics, enabling the efficient solution of complex problems in a wide range of domains. At the heart of these methods lie SAT and SMT solvers, powerful algorithms that can determine the satisfiability of logical formulas and help reason about theories beyond propositional logic.”</blockquote><figure name="99f3" id="99f3" class="graf graf--figure graf-after--pullquote"><img class="graf-image" data-image-id="0*CUJtg1DT3-sX_NUE" data-width="5184" data-height="3456" data-unsplash-photo-id="9aSH7CauB9Y" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*CUJtg1DT3-sX_NUE"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-creator noopener" target="_blank">Sigmund</a> on <a href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-source noopener" target="_blank">Unsplash</a></figcaption></figure><p name="3034" id="3034" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--figure"><span class="graf-dropCap">L</span>inear Real Arithmetic (LRA) is an important concept in mathematics and computer science because it represents and solves a wide range of real-world problems. LRA involves solving linear equations and inequalities over real numbers, a fundamental mathematical concept that applies to many fields, such as economics, engineering, and physics.</p><p name="32a7" id="32a7" class="graf graf--p graf-after--p">In computer science, LRA is used extensively in formal verification, where mathematical methods are used to prove the correctness of software and hardware systems. LRA is also used in artificial intelligence and machine learning, where it is used to solve optimization problems and to model systems that involve linear constraints.</p><p name="8a7e" id="8a7e" class="graf graf--p graf-after--p">The Z3 solver is a powerful tool that can be used to solve LRA problems. Z3 is an open-source Satisfiability Modulo Theories (SMT) solver developed by Microsoft Research that can solve a wide range of problems in various logics, including LRA. The Z3 solver uses state-of-the-art algorithms and techniques to efficiently solve LRA problems, which can be difficult and time-consuming to solve manually.</p><p name="9c89" id="9c89" class="graf graf--p graf-after--p">Z3 provides a simple and flexible programming interface that allows users to define and solve LRA problems using SMT-LIB syntax, a standard format for specifying SMT problems. Z3 also includes advanced features such as optimization, interpolation, and model checking, which can help in solving complex LRA problems.</p><blockquote name="d35e" id="d35e" class="graf graf--pullquote graf-after--p">Some Examples:</blockquote><p name="7645" id="7645" class="graf graf--p graf-after--pullquote"><strong class="markup--strong markup--p-strong">Examples of LRA problems include:</strong></p><ul class="postList"><li name="b957" id="b957" class="graf graf--li graf-after--p">A company produces two types of products, product A and product B. The cost of producing one unit of product A is $3, and the cost of producing one unit of product B is $4. The company wants to produce 500 units of products with a total cost of at most $2000. How many units of each product should the company produce?</li><li name="87af" id="87af" class="graf graf--li graf-after--li">A chemical reaction is taking place in a container. The reaction produces heat, and the temperature of the container increases linearly with time. At time t=0, the temperature of the container is 20°C, and after 5 minutes, the temperature is 50°C. If the rate of temperature increase is constant, what is the temperature of the container after 10 minutes?</li><li name="7310" id="7310" class="graf graf--li graf-after--li">A car rental company charges a fixed fee of $50 per day and an additional fee of $0.20 per mile driven. How much will a customer pay if a customer rents a car for 3 days and drives 200 miles?</li></ul><p name="35cb" id="35cb" class="graf graf--p graf-after--li">These problems can be represented using mathematical equations and inequalities in the form of LRA formulas. For example, the first problem can be represented as 3x + 4y &lt;= 2000 x + y = 500, where x is the number of units of product A produced, and y is the number of units of product B produced.</p><p name="b05b" id="b05b" class="graf graf--p graf-after--p">The second problem can be represented as T = mt + b where T is the temperature of the container, m is the rate of temperature increase, t is time, and b is the initial temperature.</p><p name="d3c8" id="d3c8" class="graf graf--p graf-after--p graf--trailing">The third problem can be represented as 50 + 0.20m = C, where m is the number of miles driven, and C is the total cost.</p></div></div></section><section name="44b4" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><blockquote name="ae81" id="ae81" class="graf graf--pullquote graf--leading">Downloading and installing Z3 solver:</blockquote><ol class="postList"><li name="0ee3" id="0ee3" class="graf graf--li graf-after--pullquote">Go to the official Z3 solver website: <a href="https://github.com/Z3Prover/z3" data-href="https://github.com/Z3Prover/z3" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">https://github.com/Z3Prover/z3</a></li><li name="c95c" id="c95c" class="graf graf--li graf-after--li">Download the appropriate version of Z3 for your operating system.</li><li name="362b" id="362b" class="graf graf--li graf-after--li">Extract the downloaded file to a directory of your choice.</li><li name="8e85" id="8e85" class="graf graf--li graf-after--li">Set the environment variables as needed (see the Z3 documentation for details).</li></ol><p name="df43" id="df43" class="graf graf--p graf-after--li">Setting up an LRA problem in Z3 using SMT-LIB syntax:</p><ol class="postList"><li name="bc51" id="bc51" class="graf graf--li graf-after--p">Open a text editor.</li><li name="9017" id="9017" class="graf graf--li graf-after--li">Create a new file and save it with a “.smt2” extension.</li><li name="d39f" id="d39f" class="graf graf--li graf-after--li">Add the following lines to the beginning of the file:</li></ol><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="d43f" id="d43f" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-built_in">set</span>-logic (QF_LRA)</span></pre><ol class="postList"><li name="5a95" id="5a95" class="graf graf--li graf-after--pre">This sets the logic for LRA.</li><li name="2b39" id="2b39" class="graf graf--li graf-after--li">Define the variables in the problem using the <code class="markup--code markup--li-code">declare-const</code> command. For example:</li></ol><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="c26d" id="c26d" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content">(declare-const x Real)<br />(declare-const y Real)<br />(declare-const z Real)</span></pre><p name="a37c" id="a37c" class="graf graf--p graf-after--pre">Add the constraints using the <code class="markup--code markup--p-code">assert</code> command. For example:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="fd19" id="fd19" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">(<span class="hljs-keyword">assert</span> (= (+ (* <span class="hljs-number">2</span> x) (* <span class="hljs-number">3</span> y) (* <span class="hljs-number">4</span> z)) <span class="hljs-number">10</span>))<br />(<span class="hljs-keyword">assert</span> (&lt;= x <span class="hljs-number">2</span>))<br />(<span class="hljs-keyword">assert</span> (&gt;= y <span class="hljs-number">0</span>))</span></pre><ol class="postList"><li name="a755" id="a755" class="graf graf--li graf-after--pre">The first constraint sets the sum of 2x, 3y, and 4z equal to 10. The second and third constraints set bounds on x and y, respectively.</li><li name="260c" id="260c" class="graf graf--li graf-after--li">Add the <code class="markup--code markup--li-code">check-sat</code> command to check the satisfiability of the constraints. For example:</li></ol><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="5675" id="5675" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content">(check-sat)</span></pre><p name="80ed" id="80ed" class="graf graf--p graf-after--pre">If the constraints are satisfiable, use the <code class="markup--code markup--p-code">get-model</code> command to get a model that satisfies the constraints. For example:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="a56f" id="a56f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">(get-model)</span></pre><p name="b6e1" id="b6e1" class="graf graf--p graf-after--pre">Here is an example of an LRA problem in Z3 using SMT-LIB syntax:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="bash" name="73ad" id="73ad" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">(set-logic QF_LRA)<br /><br />(declare-const x Real)<br />(declare-const y Real)<br />(declare-const z Real)<br /><br />(assert (= (- (+ (* 3 x) (* 2 y)) z) 1))<br />(assert (= (+ (- (* 2 x) (* 2 y)) (* 4 z)) -2))<br />(assert (= (- (+ (- 0 x) (* 0.5 y)) z) 0))<br /><br />(check-sat)<br />(get-model)</span></pre><p name="34df" id="34df" class="graf graf--p graf-after--pre">This problem involves three real variables, x, y, and z, and three linear constraints involving these variables. The <code class="markup--code markup--p-code">check-sat</code> command checks the satisfiability of the constraints and the <code class="markup--code markup--p-code">get-model</code> command returns a model that satisfies the constraints if they are satisfiable.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="9033" id="9033" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">sat<br />(<br />  (define-fun y () Real<br />    (- <span class="hljs-number">2.0</span>))<br />  (define-fun x () Real<br />    <span class="hljs-number">1.0</span>)<br />  (define-fun z () Real<br />    (- <span class="hljs-number">2.0</span>))<br />)</span></pre><p name="eab4" id="eab4" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">Python equivalent for the above code:</strong></p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="8921" id="8921" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br /><br /><span class="hljs-comment"># set the logic</span><br />set_option(<span class="hljs-string">&#x27;model&#x27;</span>, <span class="hljs-literal">True</span>)<br />set_option(<span class="hljs-string">&#x27;smt.arith.nl&#x27;</span>, <span class="hljs-literal">True</span>)<br /><br /><span class="hljs-comment"># declare variables</span><br />x = Real(<span class="hljs-string">&#x27;x&#x27;</span>)<br />y = Real(<span class="hljs-string">&#x27;y&#x27;</span>)<br />z = Real(<span class="hljs-string">&#x27;z&#x27;</span>)<br /><br /><span class="hljs-comment"># add constraints</span><br />s = Solver()<br />s.add((-<span class="hljs-number">1</span>) * (<span class="hljs-number">3</span> * x + <span class="hljs-number">2</span> * y - z - <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>)<br />s.add(<span class="hljs-number">2</span> * x - <span class="hljs-number">2</span> * y + <span class="hljs-number">4</span> * z + <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)<br />s.add((-<span class="hljs-number">1</span>) * x + <span class="hljs-number">0.5</span> * y - z == <span class="hljs-number">0</span>)<br /><br /><span class="hljs-comment"># check satisfiability and print model</span><br /><span class="hljs-keyword">if</span> s.check() == sat:<br />    <span class="hljs-built_in">print</span>(s.model())<br /><span class="hljs-keyword">else</span>:<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;unsat&quot;</span>)</span></pre><blockquote name="1ad2" id="1ad2" class="graf graf--pullquote graf-after--pre">Advanced features of Z3</blockquote><p name="507e" id="507e" class="graf graf--p graf-after--pullquote">Z3 solver provides several advanced features that can help in solving LRA problems more efficiently. Two of the most useful features are optimization and interpolation.</p><p name="2add" id="2add" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--p"><span class="graf-dropCap">O</span><strong class="markup--strong markup--p-strong">ptimization</strong>: Optimization in Z3 is used to find a given objective function&#39;s maximum or minimum value subject to constraints. This feature is particularly useful in LRA problems that involve maximizing or minimizing a linear function.</p><p name="a0df" id="a0df" class="graf graf--p graf-after--p">Example: Suppose we want to maximize the expression 2x + 3y subject to the constraints 3x + 4y &lt;= 12 and 2x — y &lt;= 3. We can represent this problem in SMT-LIB syntax as follows:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="16ba" id="16ba" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">(<span class="hljs-built_in">set</span>-logic QF_LRA)<br /><br />(declare-const x Real)<br />(declare-const y Real)<br /><br />(<span class="hljs-keyword">assert</span> (&lt;= (+ (* <span class="hljs-number">3</span> x) (* <span class="hljs-number">4</span> y)) <span class="hljs-number">12</span>))<br />(<span class="hljs-keyword">assert</span> (&lt;= (+ (* <span class="hljs-number">2</span> x) (* -<span class="hljs-number">1</span> y)) <span class="hljs-number">3</span>))<br />(maximize (+ (* <span class="hljs-number">2</span> x) (* <span class="hljs-number">3</span> y)))<br /><br />(check-sat)<br />(get-model)</span></pre><p name="33b1" id="33b1" class="graf graf--p graf-after--pre">The <code class="markup--code markup--p-code">maximize</code> command is used to specify the objective function that we want to maximize. The output of this program will provide us with the maximum value of the objective function and the values of x and y that achieve this maximum.</p><p name="89e2" id="89e2" class="graf graf--p graf--hasDropCapModel graf--hasDropCap graf-after--p"><span class="graf-dropCap">I</span><strong class="markup--strong markup--p-strong">nterpolation</strong>: Interpolation in Z3 is used to find a formula that interpolates between two given formulas. This feature is particularly useful in LRA problems that involve proving the validity of a formula or checking the satisfiability of a set of formulas.</p><p name="c20c" id="c20c" class="graf graf--p graf-after--p">Example: Suppose we want to prove the formula (x + y) &gt;= 2 given the constraints x &gt;= 1 and y &gt;= 1. We can represent this problem in SMT-LIB syntax as follows:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="1d91" id="1d91" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">(<span class="hljs-built_in">set</span>-logic QF_LRA)<br />(declare-const x Real)<br />(declare-const y Real)<br />(<span class="hljs-keyword">assert</span> (&gt;= x <span class="hljs-number">1</span>))<br />(<span class="hljs-keyword">assert</span> (&gt;= y <span class="hljs-number">1</span>))<br />(<span class="hljs-keyword">assert</span> (<span class="hljs-keyword">not</span> (&gt;= (+ x y) <span class="hljs-number">2</span>)))<br />(interpolate ((&gt;= x <span class="hljs-number">1</span>) (&gt;= y <span class="hljs-number">1</span>)) ((<span class="hljs-keyword">not</span> (&gt;= (+ x y) <span class="hljs-number">2</span>)))))</span></pre><p name="781c" id="781c" class="graf graf--p graf-after--pre">The <code class="markup--code markup--p-code">interpolate</code> command takes two sets of formulas: the first set contains the formulas that imply the negation of the target formula, and the second set contains the target formula itself. The output of this program will provide us with an interpolant formula between the two sets of formulas. If the interpolant is a constant true formula, then the original formula is valid; otherwise, it is unsatisfiable.</p><p name="e508" id="e508" class="graf graf--p graf-after--p">Z3 solver provides several advanced features that can help in solving LRA problems more efficiently, including optimization and interpolation. These features can be useful in a variety of LRA problems, such as maximizing or minimizing linear functions and proving the validity of formulas.</p><blockquote name="cdd9" id="cdd9" class="graf graf--pullquote graf-after--p">Conclusion:</blockquote><p name="189b" id="189b" class="graf graf--p graf-after--pullquote">This article discusses the Linear Real Arithmetic (LRA) concept and its significance in mathematics and computer science. It also introduces the Z3 solver, a powerful tool for solving LRA problems using SMT-LIB syntax. The article provides step-by-step instructions on downloading, installing, and setting up the Z3 solver and examples of LRA problems and their corresponding SMT-LIB syntax. It also explains how to interpret the output from Z3 and determine if a problem is satisfiable or unsatisfiable.</p><p name="8586" id="8586" class="graf graf--p graf-after--p">Moreover, the article highlights the advanced features of Z3, including optimization and interpolation, and provides examples of how to use these features. It emphasizes the importance of using tools like Z3 in solving complex LRA problems in various fields, including optimization problems, verification of hardware and software systems, and artificial intelligence.</p><p name="065c" id="065c" class="graf graf--p graf-after--p graf--trailing">The article shows that using a powerful solver like Z3 can significantly improve efficiency, accuracy, and reliability in solving LRA problems in mathematics and computer science.</p></div></div></section><section name="4264" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><blockquote name="6a5a" id="6a5a" class="graf graf--pullquote graf--leading">References:</blockquote><ul class="postList"><li name="275a" id="275a" class="graf graf--li graf-after--pullquote">The Z3 Theorem Prover: <a href="http://z3prover.github.io/" data-href="http://z3prover.github.io/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">http://z3prover.github.io/</a></li><li name="ca60" id="ca60" class="graf graf--li graf-after--li">The SMT-LIB Standard: <a href="http://smtlib.cs.uiowa.edu/" data-href="http://smtlib.cs.uiowa.edu/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">http://smtlib.cs.uiowa.edu/</a></li><li name="0b95" id="0b95" class="graf graf--li graf-after--li">Linear Programming: Foundations and Extensions, 3rd Edition, by Robert J. Vanderbei</li><li name="91db" id="91db" class="graf graf--li graf-after--li">Linear and Nonlinear Programming, 4th Edition, by David G. Luenberger and Yinyu Ye</li><li name="d7b5" id="d7b5" class="graf graf--li graf-after--li">Numerical Optimization, 2nd Edition, by Jorge Nocedal and Stephen Wright</li><li name="1a08" id="1a08" class="graf graf--li graf-after--li">Verification of Computer Systems, by Orna Grumberg and Doron Peled</li><li name="071a" id="071a" class="graf graf--li graf-after--li graf--trailing">Artificial Intelligence: A Modern Approach, 4th Edition, by Stuart Russell and Peter Norvig</li></ul></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@the_daft_introvert" class="p-author h-card">Vishal Sharma</a> on <a href="https://medium.com/p/6bd39c9e19e2"><time class="dt-published" datetime="2023-03-24T11:43:12.972Z">March 24, 2023</time></a>.</p><p><a href="https://medium.com/@the_daft_introvert/solving-linear-real-arithmetic-problems-with-z3-solver-a-comprehensive-guide-6bd39c9e19e2" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 2, 2023.</p></footer></article></body></html>